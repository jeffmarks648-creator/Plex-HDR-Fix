# This is a sample mpv.conf file. You may edit this file as you desire to change MPV's behavior. See the mpv.conf.md file for more info

vo=gpu-next
osd-font-size=20

# Use osd-msg1 to switch between MPV defaults and custom profiles
# "auto": MPV Default behavior
# "custom": Custom tone mapping profiles below
osd-msg1="custom"

# Setup the default output of MPV
# yes: default output as HDR
# no: default output as SDR
target-colorspace-hint=no

# --- Global Profiles ---
# Plex config are for vo=gpu, this config is for vo=gpu-next to remove the blur (esp 1080p)
scale=ewa_lanczossharp   
scale-antiring=0         
dscale=mitchell
dscale-antiring=0        
cscale=spline36          
cscale-antiring=0        

# --- Shader ---
glsl-shaders-clr
glsl-shaders-append="~~/shaders/KrigBilateral.glsl"
glsl-shaders-append="~~/shaders/SSimSuperRes-mitchell.glsl"
glsl-shaders-append="~~/shaders/SSimDownscaler.glsl"

# --- Video Profiles ---
video-sync=display-resample
interpolation=no
tscale=oversample

# ---Dot-To-Dot Profiles ---
# This to disable upscale if the width difference < 10 pixel. e.g. 1918 or 3836 width
# Mainly prevent blur due to just upsacling for several pixels.

[dot-to-dot-fix]
profile-restore=copy
profile-cond=width >= (osd_width - 10) and width < osd_width
video-unscaled=downscale-big

# --- Output Default Profiles ---

[SDR-Output]
profile-cond=p["target-colorspace-hint"] == false
# For 8-bit SDR Monitor as MPV somehow wrongly determine 10-bit output
d3d11-output-format=rgba8
dither-depth=8
dither=fruit

[HDR-Output]
profile-cond=p["target-colorspace-hint"] == true
d3d11-output-format=auto
dither-depth=auto
dither=error-diffusion

# --- MPV Default Profiles ---
[MPV-Default]
profile-cond=p["options/osd-msg1"] == "auto"
target-peak=auto
hdr-compute-peak=no
inverse-tone-mapping=yes
tone-mapping=auto
tone-mapping-param=0.3 # assume spline
saturation=0

# --- SDR Monitor Profiles ---
[SDR-SDR-Default]
profile-cond=p["video-params/sig-peak"] <= 1 and p["target-colorspace-hint"] == false and p["options/osd-msg1"] == "custom"
target-peak=auto
hdr-compute-peak=no
tone-mapping=auto

[HDR-SDR-Default]
profile-cond=p["video-params/sig-peak"] > 1 and p["target-colorspace-hint"] == false and p["options/osd-msg1"] == "custom"
# Set your target peak for SDR monitor, default is 203 which is too high and dull, 170 for better contrast
target-peak=170
hdr-compute-peak=yes
tone-mapping=spline

# --- HDR Monitor Profiles ---
[HDR-HDR-Default]
profile-cond=p["video-params/sig-peak"] > 1 and p["target-colorspace-hint"] == true and p["options/osd-msg1"] == "custom"
# Set your target peak for HDR monitor, this should exectly match your win profile to prevent additional conversion.
# DONT set to auto as MPV will skip the tone mapping and just pass-through.
target-peak=400
hdr-compute-peak=no
inverse-tone-mapping=no
tone-mapping=auto
tone-mapping-param=0.3 # assume spline
saturation=0

[SDR-HDR-Default]
profile-cond=p["video-params/sig-peak"] <= 1 and p["target-colorspace-hint"] == true and p["options/osd-msg1"] == "custom"
# Set your target peak for HDR monitor, this should exectly match your win profile to prevent additional conversion.
# DONT set to auto as MPV will skip the tone mapping and just pass-through.
target-peak=400
hdr-compute-peak=no
inverse-tone-mapping=yes
tone-mapping=auto
tone-mapping-param=0.30
saturation=1.2

# --- HDR-SDR Tone Mapping Profile ---
# Below profiles only take effect for HDR to SDR output.

[TM-User-Auto]
profile-cond=tone_mapping == 'auto' and p["target-colorspace-hint"] == false and p["options/osd-msg1"] == "custom"
tone-mapping-param=0.3 # assume spline
saturation=0

[TM-User-BT2446a]
profile-cond=tone_mapping == 'bt.2446a' and p["target-colorspace-hint"] == false and p["options/osd-msg1"] == "custom"
tone-mapping-param=0.38
saturation=2

[TM-User-BT2390]
profile-cond=tone_mapping == 'bt.2390' and p["target-colorspace-hint"] == false and p["options/osd-msg1"] == "custom"
tone-mapping-param=1.2
saturation=1

[TM-User-ST2094-40]
profile-cond=tone_mapping == 'st2094-40' and p["target-colorspace-hint"] == false and p["options/osd-msg1"] == "custom"
tone-mapping-param=1.0
saturation=2

[TM-User-ST2094-10]
profile-cond=tone_mapping == 'st2094-10' and p["target-colorspace-hint"] == false and p["options/osd-msg1"] == "custom"
tone-mapping-param=1.0
saturation=2

[TM-User-Mobius]
profile-cond=tone_mapping == 'mobius' and p["target-colorspace-hint"] == false and p["options/osd-msg1"] == "custom"
tone-mapping-param=0.50
saturation=2

[TM-User-Spline]
profile-cond=tone_mapping == 'spline' and p["target-colorspace-hint"] == false and p["options/osd-msg1"] == "custom"
tone-mapping-param=0.32
saturation=3

[TM-User-Reinhard]
profile-cond=tone_mapping == 'reinhard' and p["target-colorspace-hint"] == false and p["options/osd-msg1"] == "custom"
tone-mapping-param=0.50
saturation=4

[TM-User-Hable]
profile-cond=tone_mapping == 'hable' and p["target-colorspace-hint"] == false and p["options/osd-msg1"] == "custom"
tone-mapping-param=1.0
saturation=2

[TM-User-Gamma]
profile-cond=tone_mapping == 'gamma' and p["target-colorspace-hint"] == false and p["options/osd-msg1"] == "custom"
tone-mapping-param=2.2
saturation=0

[TM-User-Linear]
profile-cond=tone_mapping == 'linear' and p["target-colorspace-hint"] == false and p["options/osd-msg1"] == "custom"
tone-mapping-param=1.0
saturation=0

[TM-User-Clip]
profile-cond=tone_mapping == 'clip' and p["target-colorspace-hint"] == false and p["options/osd-msg1"] == "custom"
tone-mapping-param=1.0
saturation=0
